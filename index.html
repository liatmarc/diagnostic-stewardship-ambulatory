<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ambulatory Diagnostic Stewardship – Dashboard</title>
  <style>
    /* Fixed-layout, 3-column table so rows line up cleanly */
.table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;            /* <-- keeps columns aligned */
}
.table th, .table td {
  border: 1px solid #e2e8f0;
  padding: 8px 10px;
  vertical-align: top;
  text-align: left;
  word-break: break-word;         /* prevent overflow on long phrases */
  overflow-wrap: anywhere;
}
.table th {
  background: #f1f5f9;
  font-weight: 600;
}
.table.zebra tbody tr:nth-child(even) {
  background: #f8fafc;
}
  :root { --bg:#f8fafc; --fg:#0f172a; --muted:#475569; --card:#ffffff; --accent:#1d4ed8; }
    html, body { margin:0; padding:0; background:var(--bg); color:var(--fg); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
    .container { max-width:1100px; margin:24px auto; padding:0 16px; }
    header { display:flex; align-items:center; gap:12px; margin-bottom:12px; flex-wrap:wrap; }
    h1 { font-size:1.6rem; margin:6px 0 0; }
    .subtitle { color:var(--muted); margin:0; }
    .card { background:var(--card); border-radius:16px; box-shadow:0 10px 20px rgba(0,0,0,0.05); padding:16px; }
    figure { margin:0; }
    figcaption { color:var(--muted); font-size:0.9rem; margin-top:8px; }
    .downloads a { display:inline-block; margin-right:12px; margin-bottom:8px; text-decoration:none; color:var(--accent); }
    table { width:100%; border-collapse:collapse; font-size:0.95rem; }
    th, td { border-bottom:1px solid #e2e8f0; padding:8px; text-align:left; vertical-align:top; }
    th { background:#f1f5f9; }
    .footer { color:var(--muted); font-size:0.9rem; margin-top:16px; }
    .badge { padding:2px 8px; border-radius:9999px; background:#e2e8f0; font-size:0.8rem; }
    .tabs { display:flex; gap:8px; margin-top:16px; margin-bottom:16px; flex-wrap:wrap; }
    .tab-btn { background:#e2e8f0; border:none; padding:8px 12px; border-radius:9999px; cursor:pointer; }
    .tab-btn.active { background:var(--accent); color:white; }
    .tab-panel { display:none; }
    .tab-panel.active { display:block; }
    .grid { display:grid; gap:16px; grid-template-columns:1fr; }
    @media (min-width:900px) { .grid { grid-template-columns: 1fr 1fr; } }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Ambulatory Diagnostic Stewardship</h1>
        <p class="subtitle">Outpatient classification with interventions, follow-up, and outreach (simulated data)</p>
      </div>
    </header>

    <div class="card" style="margin-bottom:16px;">
      <div style="display:flex; gap:16px; flex-wrap:wrap; align-items:center;">
        <div><span class="badge">Build:</span> 2025-08-08T19:39:58</div>
        <div><span class="badge">Rows:</span> 700</div>
      </div>
    </div>

    <div class="tabs">
      <button class="tab-btn active" data-tab="overview">Overview</button>
      <button class="tab-btn" data-tab="followup">Follow-up</button>
      <button class="tab-btn" data-tab="outreach">Outreach</button>
    </div>

    <section id="overview" class="tab-panel active">
      <div class="grid">
        <div class="card">
          <figure>
            <img src="dept_classification_stacked_amb.png" alt="Department Classification" style="width:100%; border-radius:12px;">
            <figcaption>Distribution of test classifications by department (percent of all tests).</figcaption>
          </figure>
        </div>
        <div class="card">
          <figure>
            <img src="monthly_non_actionable_rate_amb.png" alt="Monthly Non-actionable Rate" style="width:100%; border-radius:12px;">
            <figcaption>Monthly non-actionable diagnostic test rate.</figcaption>
          </figure>
        </div>
      </div>

      <div class="card" style="margin-top:16px;">
        <h2 style="margin-top:0;">Category → Intervention Mapping</h2>
        <table id="map-table"></table>
      </div>

      <div class="card" style="margin-top:16px;">
        <h2 style="margin-top:0;">Download Data (Overview)</h2>
        <div class="downloads">
          <a href="ambulatory_tests_raw_amb.csv" download>ambulatory_tests_raw_amb.csv</a>
          <a href="ambulatory_tests_processed_amb.csv" download>ambulatory_tests_processed_amb.csv</a>
          <a href="summary_by_department_amb.csv" download>summary_by_department_amb.csv</a>
          <a href="monthly_non_actionable_rate_amb.csv" download>monthly_non_actionable_rate_amb.csv</a>
          <a href="classification_interventions_amb.csv" download>classification_interventions_amb.csv</a>
          <a href="data_quality_report_amb.csv" download>data_quality_report_amb.csv</a>
        </div>
      </div>
    </section>

    <section id="followup" class="tab-panel">
      <div class="grid">
        <div class="card">
          <figure>
            <img src="follow_up_time_distribution_amb.png" alt="Follow-up Time Distribution" style="width:100%; border-radius:12px;">
            <figcaption>Days from test to follow-up for abnormal results with action.</figcaption>
          </figure>
        </div>
        <div class="card">
          <h2 style="margin-top:0;">Summary (by Department)</h2>
          <table id="follow-summary"></table>
        </div>
      </div>
      <div class="card" style="margin-top:16px;">
        <h2 style="margin-top:0;">Download Data (Follow-up)</h2>
        <div class="downloads">
          <a href="follow_up_time_summary_amb.csv" download>follow_up_time_summary_amb.csv</a>
          <a href="follow_up_time_detail_amb.csv" download>follow_up_time_detail_amb.csv</a>
        </div>
      </div>
    </section>

    <section id="outreach" class="tab-panel">
      <div class="grid">
        <div class="card">
          <figure>
            <img src="incomplete_by_department_amb.png" alt="Incomplete by Department" style="width:100%; border-radius:12px;">
            <figcaption>Counts of tests not completed (“Missing”) by department.</figcaption>
          </figure>
        </div>
        <div class="card">
          <h2 style="margin-top:0;">Incomplete Counts (by Department)</h2>
          <table id="outreach-counts"></table>
        </div>
      </div>
      <div class="card" style="margin-top:16px;">
        <h2 style="margin-top:0;">Download Data (Outreach)</h2>
        <div class="downloads">
          <a href="outreach_counts_by_department_amb.csv" download>outreach_counts_by_department_amb.csv</a>
          <a href="outreach_list_amb.csv" download>outreach_list_amb.csv</a>
        </div>
      </div>
    </section>

    <p class="footer">Static, client-side dashboard for GitHub Pages. Replace CSV/PNG files with production outputs to update.</p>
  </div>

  <script>
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
      });
    });


    <script>
async function loadCSVToTable(csvPath, tableEl){
    try {
        const res = await fetch(csvPath);
        const text = await res.text();
        const lines = text.trim().split('\n');
        if (lines.length === 0) return;

        const header = lines[0].split(',');
        const thead = document.createElement('thead');
        const trh = document.createElement('tr');
        header.forEach(h => {
            const th = document.createElement('th');
            th.textContent = h;
            trh.appendChild(th);
        });
        thead.appendChild(trh);
        tableEl.appendChild(thead);

        const tbody = document.createElement('tbody');
        for (let i = 1; i < lines.length; i++) {
            const tr = document.createElement('tr');
            const cells = lines[i].split(',');
            for (let j = 0; j < header.length; j++) {
                const td = document.createElement('td');
                td.textContent = (cells[j] ?? '').trim();
                tr.appendChild(td);
            }
            tbody.appendChild(tr);
        }
        tableEl.appendChild(tbody);
    } catch(e) {
        tableEl.innerHTML = `<caption style="color:red">Failed to load ${csvPath}</caption>`;
    }
}
</script>

    async function loadCSVToTable(csvPath, tableEl) {
      try {
        const res = await fetch(csvPath);
        const text = await res.text();
        const lines = text.trim().split('\n');
        if (lines.length === 0) return;
        const header = lines[0].split(',');
        const thead = document.createElement('thead');
        const trh = document.createElement('tr');
        header.forEach(h => { const th = document.createElement('th'); th.textContent = h; trh.appendChild(th); });
        thead.appendChild(trh);
        tableEl.appendChild(thead);
        const tbody = document.createElement('tbody');
        for (let i = 1; i < lines.length; i++) {
          const cols = lines[i].split(',');
          const tr = document.createElement('tr');
          cols.forEach(c => { const td = document.createElement('td'); td.textContent = c; tr.appendChild(td); });
          tbody.appendChild(tr);
        }
        tableEl.appendChild(tbody);
      } catch (e) {
        console.error('Failed to load CSV', csvPath, e);
      }
    }
    loadCSVToTable('classification_interventions_amb.csv',document.getElementById('map-table'),
     ['18%','47%','35%']   // adjust if you prefer
     );
    loadCSVToTable('follow_up_time_summary_amb.csv', document.getElementById('follow-summary'));
    loadCSVToTable('outreach_counts_by_department_amb.csv', document.getElementById('outreach-counts'));
  </script>
  <div class="card" id="process-flow" style="margin-top:16px;">
  <h2 style="margin-top:0;">How this is automated</h2>
  <p class="subtitle">End-to-end pipeline: SQL extraction → Python validation & classification → Aggregation → Dashboard → Logging & Scheduling.</p>
  <figure>
    <img src="diagnostic_pipeline_flowchart.png" alt="Automated Pipeline Flowchart" style="width:100%; border-radius:12px; max-width:900px;">
    <figcaption>Monthly, parameterized, headless run with built-in QC and audit logging.</figcaption>
  </figure>
  <p class="subtitle">Prefer a printable version? <a href="diagnostic_pipeline_flowchart.pdf">Download the PDF</a>.</p>
</div>
</body>
</html>
